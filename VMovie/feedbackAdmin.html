<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>VMovie</title>

    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://unpkg.com/jquery/dist/jquery.min.js"></script>


    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://unpkg.com/jquery/dist/jquery.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase.js"></script>

    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css?family=Itim" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Itim" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
    <link rel="stylesheet" href="css/index.css">


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
    <script src="js/admin.js"></script>
</head>

<body>
    <ons-page>
        <ons-toolbar style="background-color:#7859ff;">
            <div class="left">
                <a href="home.html">
                    &nbsp;&nbsp;<i class="fa fa-reply" aria-hidden="true" style="color:white; font-size: 20px;"></i>
                </a>
            </div>
        </ons-toolbar>

        <div class="container-fluid">
            
                <div class="table-responsive">
                    <table class="table table-striped text-center" id="show-comment">

                    </table>
                </div>
            
        </div>

    </ons-page>


    <script>
        var uidAdmin = localStorage.getItem('uidAdmin');
        if (uidAdmin) {
            $('#uidAdmin').html(uidAdmin);
        }
        console.log(uidAdmin);
    </script>





    // Initialize Firebase

    <!-- <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <!--Configure firebase-->
    <script>

        var email = localStorage.getItem('email');
        if (email) {
            $('#email').html(email);
        }
        console.log(email);




        // Initialize Firebase
        
        // เปลี่ยน Apikey จาก Firebase เป็นของผู้พัฒนา
            var config = {
                apiKey: "API", 
                authDomain: "vmovie-5dd1.firebaseapp.com",
                databaseURL: "https://vmovie-5dd1.firebaseio.com",
                projectId: "vmovie-58dd1",
                storageBucket: "vmovie-5dd1.appspot.com",
                messagingSenderId: "6130514"
            };


        firebase.initializeApp(config);
        var database = firebase.database();




        var searchParams = new URLSearchParams(window.location.search);
        console.log("QueryString", searchParams.get("id"))

        // var idMovie =searchParams.get("id");
        var idMovie = searchParams.get("id");

        var nameAdmin = "ADMIN";
        database.ref('admin/feedback/').once('value', function (snapshot) {
            if (snapshot.exists()) {
                var content = '';
                snapshot.forEach(function (feedback) {
                    var val = feedback.val();
                    var commentKey = feedback.key;
                    database.ref('admin/feedback/' + feedback.key + '/message/').once('value', function (snapshot) {
                        if (snapshot.exists()) {
                            var content = '';
                            snapshot.forEach(function (message) {
                                var val = message.val();
                                var commentKey = message.key;

                                if (val.email != nameAdmin) {

                                    console.log("comment Key = " + commentKey);
                                    console.log("email = " + val.email);
                                    console.log("comment = " + val.comment);

                                    content += '<div class="card border-primary"><ons-row>';
                                    content += '<ons-cal>' + val.comment + '<br>' + val.email + '&nbsp</ons-cal>';
                                    content += '<ons-cal>  <a class="btn btn-info" href="replyFeedback.html?id=' + feedback.key + '" role="button" aria-expanded="false">ตอบกลับ</a ></ons-cal> ';
                                    content += '</ons-row></ons-card></div>';
                                }
                            })
                            var theDiv = document.getElementById("show-comment");
                            theDiv.innerHTML += content;
                        }


                    })
                })
            }
        })

    </script>
</body>

</html>
